---
phase: 01-runtime-guardrails-and-ipc-backbone
plan: 04
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/main/runtime-trust/trust-check.ts
  - src/main/runtime-trust/trust-report.ts
  - src/main/ipc/runtime-trust-controller.ts
  - src/preload/runtime-trust-bridge.ts
  - src/preload/index.ts
  - src/renderer/components/LocalOnlyBadge.tsx
  - src/renderer/settings/privacy/RuntimeChecksRow.tsx
  - src/renderer/settings/privacy/PrivacySettingsPage.tsx
autonomous: true
must_haves:
  truths:
    - "User sees a Local-only mode badge with tooltip explaining internal connections stay on device."
    - "Settings > Privacy shows Runtime checks with Details and Copy report."
    - "If trust status is unconfirmed, app warns and offers Retry/Details but keeps local core usage available."
  artifacts:
    - path: "src/main/runtime-trust/trust-check.ts"
      provides: "Runtime trust evaluation with verified/unconfirmed outcomes"
      contains: "verified"
    - path: "src/renderer/components/LocalOnlyBadge.tsx"
      provides: "Local-only mode badge and tooltip"
      contains: "Internal connections stay on this device"
    - path: "src/renderer/settings/privacy/RuntimeChecksRow.tsx"
      provides: "Runtime checks summary row with Details and Copy report"
      contains: "No local ports detected"
  key_links:
    - from: "src/main/runtime-trust/trust-report.ts"
      to: "src/main/ipc/runtime-trust-controller.ts"
      via: "report builder exposed to renderer bridge"
      pattern: "buildTrustReport"
    - from: "src/preload/runtime-trust-bridge.ts"
      to: "src/renderer/settings/privacy/RuntimeChecksRow.tsx"
      via: "fetches trust result and triggers retry/copy actions"
      pattern: "runtime:trust"
---

<objective>
Implement runtime trust visibility: Local-only badge, privacy diagnostics row, and unconfirmed-state fallback behavior.

Purpose: Give users confidence in no-ports runtime posture without blocking core local workflows.
Output: Main trust-check/report pipeline and renderer trust UI with Details/Retry/Copy report actions.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-CONTEXT.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-RESEARCH.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-01-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build trust-check and diagnostic report pipeline in main process</name>
  <files>src/main/runtime-trust/trust-check.ts, src/main/runtime-trust/trust-report.ts, src/main/ipc/runtime-trust-controller.ts</files>
  <action>Implement runtime trust evaluation that reports `verified` or `unconfirmed` status and includes diagnostics details for copy/report views. Use app/runtime evidence available from Electron APIs and no-localhost checks from plan 01; do not claim certainty when evidence is incomplete.</action>
  <verify>npm run test -- src/main/runtime-trust/trust-check.test.ts</verify>
  <done>Trust controller returns structured summary + details payload and supports explicit retry action.</done>
</task>

<task type="auto">
  <name>Task 2: Expose trust APIs to renderer and add Local-only badge</name>
  <files>src/preload/runtime-trust-bridge.ts, src/preload/index.ts, src/renderer/components/LocalOnlyBadge.tsx</files>
  <action>Expose narrow trust APIs in preload and render a small `Local-only mode` badge with tooltip text exactly: `Internal connections stay on this device`. Keep this signal subtle and out of main flow by default.</action>
  <verify>npm run test -- src/preload/runtime-trust-bridge.test.ts</verify>
  <done>Renderer reads trust status through bridge and displays local-only badge with required tooltip copy.</done>
</task>

<task type="auto">
  <name>Task 3: Add Settings > Privacy runtime checks row with Details and Copy report</name>
  <files>src/renderer/settings/privacy/RuntimeChecksRow.tsx, src/renderer/settings/privacy/PrivacySettingsPage.tsx</files>
  <action>Implement `Runtime checks` row showing `No local ports detected` when verified, and warning state when unconfirmed with `Retry` + `Details`. Keep local dictation/assistant available in unconfirmed state and reserve any feature-disable logic only for future sensitive network-linked extras.</action>
  <verify>npm run test -- src/renderer/settings/privacy/RuntimeChecksRow.test.tsx</verify>
  <done>Privacy settings show trust status, details expander, and copy report action for both verified and unconfirmed paths.</done>
</task>

</tasks>

<verification>
Run trust pipeline and renderer settings tests, then confirm badge and privacy row show expected verified/unconfirmed behavior.
</verification>

<success_criteria>
Users can inspect runtime trust posture with clear human messaging while core local features remain usable under unconfirmed checks.
</success_criteria>

<output>
After completion, create `.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-04-SUMMARY.md`
</output>
