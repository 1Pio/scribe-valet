---
phase: 01-runtime-guardrails-and-ipc-backbone
plan: 08
type: execute
wave: 6
depends_on:
  - 01-06
  - 01-07
files_modified:
  - src/main/index.ts
  - src/main/window/renderer-recovery.ts
  - src/main/window/renderer-recovery.test.ts
  - src/main/ipc/runtime-controller.ts
  - src/main/ipc/runtime-controller.test.ts
  - .planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md
  - .planning/phases/01-runtime-guardrails-and-ipc-backbone/01-HUMAN-VERIFICATION-NOTES.md
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "If the renderer process exits unexpectedly, the app automatically restores a usable UI session without requiring the user to manually kill and relaunch Electron."
    - "Renderer crash recovery does not weaken Phase 1 no-ports guarantees and does not change fix-now/try-again/restart-app action semantics."
    - "Human crash-continuity verification can be re-run with explicit steps and a deterministic expected recovery outcome."
  artifacts:
    - path: "src/main/window/renderer-recovery.ts"
      provides: "Dedicated renderer crash signal handling and recovery decision logic"
      contains: "render-process-gone|unresponsive|recovery"
    - path: "src/main/index.ts"
      provides: "Main window wiring that installs renderer recovery hooks during bootstrap"
      contains: "webContents"
    - path: ".planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md"
      provides: "Updated UAT crash-recovery recheck steps and expected continuity outcome"
      contains: "renderer"
  key_links:
    - from: "src/main/index.ts"
      to: "src/main/window/renderer-recovery.ts"
      via: "Bootstrap installs renderer lifecycle guards on BrowserWindow webContents"
      pattern: "createMainWindow|install"
    - from: "src/main/window/renderer-recovery.ts"
      to: "src/main/ipc/runtime-controller.ts"
      via: "Renderer recovery keeps status channel delivery viable after crash/reload"
      pattern: "STATUS_CHANGED"
    - from: ".planning/phases/01-runtime-guardrails-and-ipc-backbone/01-HUMAN-VERIFICATION-NOTES.md"
      to: ".planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md"
      via: "Human gap evidence and recheck instructions remain synchronized"
      pattern: "renderer crash"
---

<objective>
Close the remaining Phase 1 human-verified gap where a forced renderer-process exit leaves a persistent blank window.

Purpose: Preserve runtime trust/recovery continuity by restoring renderer usability automatically (or through deterministic fallback) after renderer failure.
Output: Main-process renderer crash recovery wiring, focused tests for recovery decisions, and updated UAT/human-verification evidence for recheck.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-CONTEXT.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-HUMAN-VERIFICATION-NOTES.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-runtime-guardrails-and-ipc-backbone-VERIFICATION.md
@src/main/index.ts
@src/main/ipc/runtime-controller.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add renderer crash lifecycle recovery in main window wiring</name>
  <files>src/main/index.ts, src/main/window/renderer-recovery.ts</files>
  <action>Install explicit BrowserWindow/webContents handlers for renderer failure signals (`render-process-gone`, `unresponsive`, and first-load failure edge cases) and apply deterministic recovery behavior that restores a usable renderer session without introducing localhost services. Keep existing runtime action mapping (`fix-now`, `try-again`, `restart-app`) unchanged. If immediate in-place reload cannot restore usability, trigger controlled app relaunch intent as fallback.</action>
  <verify>npm run test -- src/main/window/renderer-recovery.test.ts</verify>
  <done>Forced renderer exits no longer strand the app in a permanent blank shell; recovery path is deterministic and Phase 1 trust constraints remain intact.</done>
</task>

<task type="auto">
  <name>Task 2: Add focused tests for renderer recovery decisions and IPC continuity</name>
  <files>src/main/window/renderer-recovery.test.ts, src/main/ipc/runtime-controller.ts, src/main/ipc/runtime-controller.test.ts</files>
  <action>Create unit coverage for renderer recovery decision logic (recoverable crash, repeated failure fallback, non-renderer event ignore), and extend runtime-controller tests as needed to ensure status broadcasts/handlers remain valid after recovery wiring changes. Do not alter protocol IDs, version guards, or restart-app relaunch contract semantics from Plan 01-07.</action>
  <verify>npm run test -- src/main/window/renderer-recovery.test.ts src/main/ipc/runtime-controller.test.ts</verify>
  <done>Test suite proves renderer recovery behavior and confirms runtime controller contracts stay stable.</done>
</task>

<task type="auto">
  <name>Task 3: Update UAT + human verification docs and recheck crash continuity</name>
  <files>.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md, .planning/phases/01-runtime-guardrails-and-ipc-backbone/01-HUMAN-VERIFICATION-NOTES.md</files>
  <action>Update UAT and human verification notes with explicit renderer-crash recheck steps, expected automatic recovery/fallback behavior, and outcome recording guidance. Re-run runtime validation plus focused tests, then mark the renderer crash continuity gap as closed only if evidence demonstrates the blank-window condition is no longer persistent.</action>
  <verify>npm run validate:runtime && npm run test -- src/main/window/renderer-recovery.test.ts src/main/ipc/runtime-controller.test.ts src/renderer/runtime-status/runtime-state-machine.test.ts</verify>
  <done>Phase 1 human verification artifacts include deterministic crash continuity evidence instead of an unresolved renderer blank-window note.</done>
</task>

</tasks>

<verification>
Force a renderer-process exit during a live session and confirm app usability is automatically restored (or app relaunch fallback executes), then verify runtime controls and trust checks still function without localhost transport regressions.
</verification>

<success_criteria>
The final Phase 1 human gap is closed: renderer failure no longer leaves an unrecoverable blank shell, and recovery behavior is documented, tested, and repeatable.
</success_criteria>

<output>
After completion, create `.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-08-SUMMARY.md`
</output>
