---
phase: 01-runtime-guardrails-and-ipc-backbone
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/main/index.ts
  - src/preload/index.ts
  - src/renderer/index.tsx
  - src/shared/protocol/ipc-envelope.ts
  - src/shared/protocol/handshake.ts
  - scripts/runtime/no-localhost-check.mjs
autonomous: true
must_haves:
  truths:
    - "User can launch the desktop app without any internal localhost API service."
    - "Internal runtime messages move through IPC contracts, not HTTP requests."
    - "Build-time/runtime checks fail fast if localhost transport is introduced."
  artifacts:
    - path: "src/shared/protocol/ipc-envelope.ts"
      provides: "Versioned IPC envelope and channel constants"
      contains: "protocolVersion"
    - path: "src/main/index.ts"
      provides: "Main process startup using IPC transport only"
      contains: "ipcMain.handle"
    - path: "scripts/runtime/no-localhost-check.mjs"
      provides: "Guardrail check that blocks localhost patterns"
      contains: "localhost"
  key_links:
    - from: "src/preload/index.ts"
      to: "src/main/index.ts"
      via: "contextBridge methods mapped to ipcRenderer.invoke channels"
      pattern: "ipcRenderer\.invoke"
    - from: "scripts/runtime/no-localhost-check.mjs"
      to: "src/main"
      via: "source scan for http://127.0.0.1 and localhost usage"
      pattern: "localhost|127\\.0\\.0\\.1"
---

<objective>
Create the executable Phase 1 foundation: Electron runtime skeleton, versioned IPC contract, and hard no-localhost guardrails.

Purpose: Establish ARCH-01 constraints before lifecycle and UX layers are added.
Output: Runnable app shell with IPC-only transport boundaries and automated localhost prevention checks.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-CONTEXT.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bootstrap Electron runtime entry points with narrow bridge</name>
  <files>package.json, tsconfig.json, src/main/index.ts, src/preload/index.ts, src/renderer/index.tsx</files>
  <action>Set up the minimal Electron + TypeScript app shell with explicit main/preload/renderer boundaries. Expose only task-scoped preload methods (no raw ipcRenderer exposure), and keep renderer communication async. Do not add any localhost HTTP server/client bootstrap code because ARCH-01 requires IPC-only internals.</action>
  <verify>npm run build</verify>
  <done>App compiles with separate main/preload/renderer entry points and renderer has only scoped bridge APIs.</done>
</task>

<task type="auto">
  <name>Task 2: Define shared IPC envelope and handshake contract primitives</name>
  <files>src/shared/protocol/ipc-envelope.ts, src/shared/protocol/handshake.ts, src/main/index.ts, src/preload/index.ts</files>
  <action>Create versioned IPC envelope types and handshake payload schemas shared by main, preload, and later worker supervisor code. Include protocol id and envelope version fields so future plans can gate compatibility deterministically. Keep channel names centralized to prevent transport drift.</action>
  <verify>npm run test -- src/shared/protocol/handshake.test.ts</verify>
  <done>Shared protocol module exports typed envelopes/handshake shapes consumed by both main and preload.</done>
</task>

<task type="auto">
  <name>Task 3: Enforce no-localhost runtime guardrails</name>
  <files>scripts/runtime/no-localhost-check.mjs, package.json</files>
  <action>Add a guardrail script and npm command that fails when forbidden loopback patterns (`localhost`, `127.0.0.1`, internal HTTP server creation) appear in runtime code. Wire it into validation scripts so Phase 1 cannot regress into localhost transports.</action>
  <verify>npm run check:no-localhost</verify>
  <done>Validation fails when localhost APIs are introduced and passes on IPC-only implementation.</done>
</task>

</tasks>

<verification>
Run `npm run build` and `npm run check:no-localhost`; both must pass on clean tree.
</verification>

<success_criteria>
ARCH-01 baseline exists: app boots with IPC boundaries and automated checks prevent localhost/internal API port drift.
</success_criteria>

<output>
After completion, create `.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-01-SUMMARY.md`
</output>
