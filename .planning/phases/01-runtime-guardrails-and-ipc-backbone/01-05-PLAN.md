---
phase: 01-runtime-guardrails-and-ipc-backbone
plan: 05
type: execute
wave: 3
depends_on:
  - 01-01
  - 01-04
files_modified:
  - src/main/index.ts
  - package.json
  - scripts/runtime/no-localhost-check.mjs
  - src/main/runtime-trust/trust-check.ts
  - src/main/runtime-trust/trust-check.test.ts
  - .planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "User can launch the app with a canonical command and see the renderer runtime bridge instead of a white window."
    - "Runtime localhost guardrail checks fail only on executable transport violations, not human-facing trust copy or benign test literals."
    - "Trust badge/privacy-row and unconfirmed-state behavior remain testable after runtime validation passes."
  artifacts:
    - path: "src/main/index.ts"
      provides: "BrowserWindow boot path that executes renderer entry bundle"
      contains: "loadFile|loadURL"
    - path: "package.json"
      provides: "Canonical local launch script for UAT"
      contains: "\"dev\""
    - path: "scripts/runtime/no-localhost-check.mjs"
      provides: "Narrow executable-transport guardrail scan policy"
      contains: "FORBIDDEN_PATTERNS"
    - path: ".planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md"
      provides: "Updated UAT launch and verification instructions aligned to canonical startup"
      contains: "npm run dev"
  key_links:
    - from: "src/main/index.ts"
      to: "src/renderer/index.tsx"
      via: "main window load target executes compiled renderer entry"
      pattern: "renderer"
    - from: "package.json"
      to: "src/main/index.ts"
      via: "dev script launches Electron against compiled runtime"
      pattern: "electron"
    - from: "scripts/runtime/no-localhost-check.mjs"
      to: "src/main/runtime-trust/trust-check.ts"
      via: "scanner rules permit approved trust wording while blocking transport violations"
      pattern: "localhost|127\\.0\\.0\\.1|createServer"
---

<objective>
Close diagnosed UAT blockers by restoring renderer boot, tightening localhost guardrail precision, and aligning UAT startup/validation flow.

Purpose: Unblock ARCH-01/ARCH-02 verification so trust UX and recovery behavior can be tested in a real running app.
Output: Working renderer launch path, canonical `npm run dev` command, narrowed no-localhost scanner, and updated UAT instructions.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-CONTEXT.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-01-SUMMARY.md
@.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-04-SUMMARY.md
@src/main/index.ts
@scripts/runtime/no-localhost-check.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restore renderer boot path and add canonical local launch script</name>
  <files>src/main/index.ts, package.json</files>
  <action>Replace the blank data URL window boot with a load target that executes the real renderer entry bundle for local runs, and add a canonical `npm run dev` script that reliably builds then launches Electron for UAT. Keep preload isolation and existing IPC/trust controller wiring intact; do not introduce localhost servers or port-based dev transport.</action>
  <verify>`npm run dev` launches without "Missing script: dev" and app UI renders `Scribe-Valet` heading plus runtime bridge status content.</verify>
  <done>App launches from canonical command with non-white renderer UI and ARCH-01 no-ports posture preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Narrow localhost guardrail scanner to executable transport violations</name>
  <files>scripts/runtime/no-localhost-check.mjs, src/main/runtime-trust/trust-check.ts, src/main/runtime-trust/trust-check.test.ts</files>
  <action>Refine scanner scope/rules so it detects real transport violations (for example HTTP server creation/imports, explicit loopback endpoint usage in runtime transport code) while ignoring benign literals in trust copy and test fixtures. Preserve locked trust messaging style: short human phrasing, Local-only/Privacy details flow, and Details + Copy report behavior. Do not add any Report issue auto-submit flow.</action>
  <verify>`npm run check:no-localhost` passes on current trust-copy/tests, and adding a temporary `http.createServer(...)` runtime snippet causes scanner failure.</verify>
  <done>Guardrail check blocks executable localhost/HTTP transport regressions without false positives from approved copy/tests.</done>
</task>

<task type="auto">
  <name>Task 3: Align UAT instructions and re-run runtime validation gates</name>
  <files>.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-UAT.md</files>
  <action>Update diagnosed UAT guidance to use canonical launch command and explicit recheck order after fixes (boot smoke check, trust badge/privacy row visibility, unconfirmed-state availability). Re-run `validate:runtime` and the relevant UAT checks for tests 1, 4, 5, and 6, recording updated status/reasons from execution output.</action>
  <verify>`npm run validate:runtime` exits 0 and 01-UAT.md reflects current pass/fail evidence using `npm run dev` startup instructions.</verify>
  <done>UAT document and validation evidence are synchronized with the fixed launch path and refined scanner behavior.</done>
</task>

</tasks>

<verification>
Confirm the app boots into renderer content from `npm run dev`, `npm run validate:runtime` passes with narrowed scanner logic, and UAT tests 1/4/5/6 are rerun with updated evidence.
</verification>

<success_criteria>
Phase 1 gap blockers are cleared enough for trust and recovery UX verification: canonical startup works, scanner precision matches ARCH-01 intent, and trust-flow UAT checks are actionable.
</success_criteria>

<output>
After completion, create `.planning/phases/01-runtime-guardrails-and-ipc-backbone/01-05-SUMMARY.md`
</output>
