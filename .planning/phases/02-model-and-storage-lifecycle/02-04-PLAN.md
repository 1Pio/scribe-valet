---
phase: 02-model-and-storage-lifecycle
plan: 04
type: execute
wave: 4
depends_on: ["02-05"]
files_modified:
  - src/renderer/model-lifecycle/ReadinessGate.tsx
  - src/renderer/model-lifecycle/ReadinessGate.test.tsx
  - src/renderer/model-lifecycle/DownloadBundleModal.tsx
  - src/renderer/model-lifecycle/DownloadBundleModal.test.tsx
  - src/renderer/model-lifecycle/StoragePathSettings.tsx
  - src/renderer/model-lifecycle/StoragePathSettings.test.tsx
  - src/renderer/model-lifecycle/ReadinessToast.tsx
  - src/renderer/app/AppShell.tsx
  - src/renderer/index.tsx
autonomous: false
must_haves:
  truths:
    - "User sees startup readiness progress with compact spinner, status text, and expandable checklist while checks run."
    - "User gets a dedicated readiness/setup screen for non-trivial model/path issues before normal use."
    - "Healthy startup shows brief fading confirmation with action to copy full readiness report."
    - "Download flow prompts once for bundle confirmation and shows per-model progress with explicit percent values."
    - "After failed auto-retries, user can retry, change path inline (create missing dir), and copy diagnostics."
  artifacts:
    - path: "src/renderer/model-lifecycle/ReadinessGate.tsx"
      provides: "Startup gate, checklist expansion, dedicated setup screen routing"
    - path: "src/renderer/model-lifecycle/DownloadBundleModal.tsx"
      provides: "Single pre-download confirmation and observe-only per-model progress"
    - path: "src/renderer/model-lifecycle/StoragePathSettings.tsx"
      provides: "Active-path display and inline path-change/create-dir interactions"
    - path: "src/renderer/model-lifecycle/ReadinessToast.tsx"
      provides: "Healthy-startup toast with optional global disable behavior"
  key_links:
    - from: "src/renderer/model-lifecycle/ReadinessGate.tsx"
      to: "window.scribeValet.modelLifecycle"
      via: "subscribe to lifecycle updates before rendering normal app content"
      pattern: "modelLifecycle|onStateChanged|getState"
    - from: "src/renderer/model-lifecycle/DownloadBundleModal.tsx"
      to: "model lifecycle state"
      via: "render user-friendly names and explicit percent text per model"
      pattern: "percent|progress|displayName"
    - from: "src/renderer/model-lifecycle/StoragePathSettings.tsx"
      to: "change-path action"
      via: "submit inline path updates and handle create-directory confirmation"
      pattern: "changePath|create"
---

<objective>
Deliver the lifecycle UI experience so startup readiness, download state, and recovery actions are clear and bounded to locked Phase 2 behavior.

Purpose: Complete MODL-01/02/03 user-facing truths with deterministic startup gating and storage path UX.
Output: Renderer readiness gate, download/recovery components, settings path controls, and human-verified startup flow.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-model-and-storage-lifecycle/02-CONTEXT.md
@.planning/phases/02-model-and-storage-lifecycle/02-RESEARCH.md
@src/renderer/app/AppShell.tsx
@src/renderer/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build startup readiness gate and healthy confirmation UX</name>
  <files>src/renderer/model-lifecycle/ReadinessGate.tsx, src/renderer/model-lifecycle/ReadinessToast.tsx, src/renderer/model-lifecycle/ReadinessGate.test.tsx, src/renderer/app/AppShell.tsx, src/renderer/index.tsx</files>
  <action>Implement startup UI behavior from locked decisions: compact spinner + status text while checks run, expandable compact checklist details, banner only after service escalation, dedicated setup screen for non-trivial problems, and healthy startup fading toast with copy-report action. Respect code-level boolean toggle so ready toast can be globally disabled in production builds.</action>
  <verify>npm run test -- src/renderer/model-lifecycle/ReadinessGate.test.tsx</verify>
  <done>App blocks normal flow only for non-trivial readiness failures, supports partial mode availability notices, and shows healthy confirmation toast behavior per toggle.</done>
</task>

<task type="auto">
  <name>Task 2: Implement bundled download and recovery controls in readiness/settings surfaces</name>
  <files>src/renderer/model-lifecycle/DownloadBundleModal.tsx, src/renderer/model-lifecycle/DownloadBundleModal.test.tsx, src/renderer/model-lifecycle/StoragePathSettings.tsx, src/renderer/model-lifecycle/StoragePathSettings.test.tsx</files>
  <action>Add one-time pre-download modal confirming location + required bundle with user-friendly heading, then observe-only per-model progress rows with explicit percent text. Add verification-failure recovery panel with compact safety message and actions: Retry, inline Change path directory (prefilled) with create-missing-directory offer, and Show/Copy diagnostics report. In normal settings view, show active path by default and keep rich reselection/onboarding behaviors out of scope.</action>
  <verify>npm run test -- src/renderer/model-lifecycle/DownloadBundleModal.test.tsx src/renderer/model-lifecycle/StoragePathSettings.test.tsx</verify>
  <done>User can confirm bundle once, observe progress, recover from verification failures using required actions, and update storage path with missing-directory handling.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human-verify startup readiness and recovery UX end-to-end</name>
  <action>Pause after automated implementation and run one end-to-end human verification pass for startup readiness, bundle download prompt/progress, integrity-failure recovery actions, mode-specific degradation messaging, and path-creation behavior.</action>
  <verify>
    1) Start app with all required models present and verify: compact startup check runs, no dedicated setup screen appears, a brief fade-out ready toast appears, and copy-report action copies full readiness details.
    2) Simulate missing model artifact and relaunch; verify one confirmation modal appears for bundle download location/models, progress lines show user-friendly names with explicit percentages, and no per-model confirmation prompts appear.
    3) Simulate integrity failure to exhaust auto-retries; verify compact safety-first message appears with Retry, inline Change path directory (prefilled current path), and Show/Copy diagnostics actions.
    4) Verify mode-specific behavior: with STT healthy but LLM/TTS unavailable, Dictation remains available with raw-output notice while Assistant is blocked.
    5) In settings, change storage path to a missing directory and verify app offers/creates directory and then shows only active path in normal UI.
    Resume signal: Type "approved" if all checks pass, or provide failing step numbers with observed behavior.
  </verify>
  <done>Human tester confirms the full locked lifecycle UX behavior or returns specific failing steps for follow-up gap closure.</done>
</task>

</tasks>

<verification>
Run renderer component tests for readiness/download/path settings, then complete manual verification checklist for startup gating and degraded mode behavior.
</verification>

<success_criteria>
Phase 2 startup and storage UX is human-verified: users can understand readiness state, recover from missing/corrupt artifacts, and manage storage paths without manual file copying.
</success_criteria>

<output>
After completion, create `.planning/phases/02-model-and-storage-lifecycle/02-model-and-storage-lifecycle-04-SUMMARY.md`
</output>
