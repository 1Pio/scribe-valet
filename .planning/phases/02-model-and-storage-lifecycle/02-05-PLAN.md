---
phase: 02-model-and-storage-lifecycle
plan: 05
type: execute
wave: 3
depends_on: ["02-03"]
files_modified:
  - src/main/ipc/model-lifecycle-controller.ts
  - src/main/ipc/model-lifecycle-controller.test.ts
  - src/preload/model-lifecycle-bridge.ts
  - src/preload/model-lifecycle-bridge.test.ts
  - src/preload/index.ts
  - src/main/index.ts
autonomous: true
must_haves:
  truths:
    - "Renderer can read startup readiness state and receive lifecycle updates sourced from main process."
    - "Renderer can trigger recovery actions (retry, change path, copy diagnostics) through validated IPC/preload channels."
    - "Lifecycle checks initialize during app bootstrap early enough to drive readiness UI before normal mode surfaces."
  artifacts:
    - path: "src/main/ipc/model-lifecycle-controller.ts"
      provides: "IPC handlers/events that map renderer lifecycle intents to ModelLifecycleService actions"
    - path: "src/preload/model-lifecycle-bridge.ts"
      provides: "Validated preload bridge exposing model lifecycle APIs on window.scribeValet"
    - path: "src/main/index.ts"
      provides: "Main bootstrap registration/initialization for lifecycle service and controller"
  key_links:
    - from: "src/main/ipc/model-lifecycle-controller.ts"
      to: "src/main/model-lifecycle/model-lifecycle-service.ts"
      via: "invoke handlers and subscriptions forwarding typed lifecycle state/actions"
      pattern: "getState|subscribe|retry|changePath|copy"
    - from: "src/preload/model-lifecycle-bridge.ts"
      to: "src/shared/protocol/ipc-envelope.ts"
      via: "channel constants and payload validation"
      pattern: "model-lifecycle|ipc"
    - from: "src/main/index.ts"
      to: "src/main/ipc/model-lifecycle-controller.ts"
      via: "startup registration before renderer mounts readiness gate"
      pattern: "register|model lifecycle"
---

<objective>
Wire lifecycle orchestration across IPC, preload, and bootstrap so renderer can consume state and invoke recovery safely.

Purpose: Complete MODL-01 and MODL-02 process-boundary wiring on top of the core service from Plan 02-03.
Output: Main IPC controller, preload bridge, and bootstrap integration with targeted tests.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-model-and-storage-lifecycle/02-CONTEXT.md
@.planning/phases/02-model-and-storage-lifecycle/02-RESEARCH.md
@src/main/ipc/runtime-controller.ts
@src/preload/runtime-status-bridge.ts
@src/main/model-lifecycle/model-lifecycle-service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement model lifecycle IPC controller bound to service actions</name>
  <files>src/main/ipc/model-lifecycle-controller.ts, src/main/ipc/model-lifecycle-controller.test.ts</files>
  <action>Create a dedicated IPC controller that exposes get-state, start-check, retry, change-path, copy-report, download-confirmation, and lifecycle update subscription channels using shared envelope/channel definitions from Plan 02-03. Forward all file/path/model operations to `ModelLifecycleService` in main process only, and include tests for handler registration, action routing, and event payload shape.</action>
  <verify>npm run test -- src/main/ipc/model-lifecycle-controller.test.ts</verify>
  <done>Controller registers all required lifecycle channels and safely routes renderer requests to the main service with typed responses/events.</done>
</task>

<task type="auto">
  <name>Task 2: Expose validated preload bridge and bootstrap wiring</name>
  <files>src/preload/model-lifecycle-bridge.ts, src/preload/model-lifecycle-bridge.test.ts, src/preload/index.ts, src/main/index.ts</files>
  <action>Add a preload bridge API under `window.scribeValet.modelLifecycle` mirroring runtime bridge conventions with input/output validation and safe subscribe/unsubscribe wrappers. Register lifecycle controller and initialize startup check wiring in main bootstrap early so renderer readiness gate can subscribe immediately after mount.</action>
  <verify>npm run test -- src/preload/model-lifecycle-bridge.test.ts && npm run build</verify>
  <done>Renderer-facing lifecycle bridge is available with validated methods/events, and app bootstrap initializes lifecycle wiring before readiness UI starts consuming state.</done>
</task>

</tasks>

<verification>
Run `npm run test -- src/main/ipc/model-lifecycle-controller.test.ts src/preload/model-lifecycle-bridge.test.ts` and `npm run build` to verify end-to-end process-boundary lifecycle wiring compiles and passes targeted tests.
</verification>

<success_criteria>
Lifecycle state and recovery controls are safely exposed from main orchestration to renderer through validated IPC/preload channels with early bootstrap initialization.
</success_criteria>

<output>
After completion, create `.planning/phases/02-model-and-storage-lifecycle/02-model-and-storage-lifecycle-05-SUMMARY.md`
</output>
